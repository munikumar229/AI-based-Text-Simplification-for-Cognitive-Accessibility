<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Text Simplifier â€” WoZ v3 (shareable)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .df-word { display: inline; }
    .df-head { letter-spacing: 0.003em; }
  /* character assist classes: subtle styling so assisted characters are visible */
  .df-char { padding: 0 0.06em; border-radius: 0.12em; }
  .df-ka, .df-ra, .df-ha, .df-i { background: rgba(99,102,241,0.06); }
  .df-va, .df-tva, .df-gva { background: rgba(99,102,241,0.04); }
  .df-ta, .df-taa, .df-ti, .df-tu { background: rgba(16,185,129,0.05); }
  .df-ga, .df-gg, .df-aa { background: rgba(234,88,12,0.04); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-white to-violet-50 p-4 sm:p-8">
  <div id="root"></div>

  <!-- React 18 + ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel to allow inline JSX editing -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- ================= APP CODE (EDIT HERE) ================= -->
  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    // ---------------- Helpers ----------------
    const LANGS = [
      { code: "hi", label: "à¤¹à¤¿à¤¨à¥à¤¦à¥€", uiLabel: "à¤¹à¤¿à¤¨à¥à¤¦à¥€", ttsLabel: "à¤œà¤¼à¥‹à¤° à¤¸à¥‡ à¤ªà¤¢à¤¼à¥‡à¤‚" },
      { code: "te", label: "à°¤à±†à°²à±à°—à±", uiLabel: "à°¤à±†à°²à±à°—à±", ttsLabel: "à°œà±‹à°°à±à°—à°¾ à°šà°¦à°µà°‚à°¡à°¿" },
      { code: "gu", label: "àª—à«àªœàª°àª¾àª¤à«€", uiLabel: "àª—à«àªœàª°àª¾àª¤à«€", ttsLabel: "àªœà«‹àª°àª¥à«€ àªµàª¾àª‚àªšà«‹" },
    ];

    const TRANSLATIONS = {
      en: {
        docTitle: "Text Simplifier â€” WoZ v3 (shareable)",
        prototype: "Prototype",
        subtitle: "Language-aware, questionnaire-guided summarization â€¢ TTS â€¢ Reading assists â€¢ WoZ",
        chooseLanguage: "Choose your language",
        welcome: "Welcome",
        continueGuest: "Continue as guest",
        login: "Log in",
        createAccount: "Create account",
        guestHint: "Guest mode saves your settings only on this device.",
        whatsHarder: "Whatâ€™s harder?",
        readingText: "Reading the text",
        readingHint: "letters too small / crowded",
        understanding: "Understanding the meaning",
        understandingHint: "long sentences / jargon",
        getsInTheWay: "What gets in the way? (choose all that apply)",
        obstacles: {
          small: "Small text",
          tight: "Tight line spacing",
          dense: "Dense paragraphs",
          complex: "Complex words",
          long: "Long sentences",
          busy: "Busy layout",
        },
        previewSettings: "Preview your comfy settings",
        textSize: "Text size: {value}px",
        lineSpacing: "Line spacing: {value}",
        letterSpacing: "Letter spacing: {value}%",
        readAloudQuestion: "Would you like it read aloud on the results screen?",
        back: "Back",
        skip: "Skip",
        next: "Next",
        addYourText: "Add your text",
        pasteText: "Paste text",
        uploadFile: "Upload file",
        pastePlaceholder: "Paste your text hereâ€¦",
        uploadHint: "(Prototype supports .txt files only)",
        loaded: "Loaded:",
        summaryLength: "Summary length: {value} words",
        simplifyVocab: "Simplify vocabulary",
        splitLongSentences: "Split long sentences",
        simplifyAction: "Simplify",
        workingOnIt: "Working on itâ€¦",
        progressUploading: "Uploading",
        progressAnalyzing: "Analyzing",
        progressSimplifying: "Simplifying",
        progressApplying: "Applying preferences",
        progressFinalizing: "Finalizing",
        detectedLanguage: "Detected language:",
        yourSimplifiedText: "Your simplified text",
        themeLight: "Light",
        themeSepia: "Sepia",
        themeDark: "Dark",
        original: "Original",
        simplified: "Simplified",
        empty: "(Empty)",
        noOutput: "(No output) Paste some text and click Simplify.",
        readingAssists: "Reading assists",
        enableAssists: "Enable assists (bold first vará¹‡a)",
        firstVarna: "First vará¹‡a to bold: {value}",
        hindiCharAssists: "Hindi character assists (à¤• / à¤µ)",
        assistsDescription: "Assists bold the first few vará¹‡a (graphemes) of each word, and â€” for Hindi â€” wrap select characters so devs can plug in alt glyphs.",
        readAloud: "Read aloud",
        resume: "Resume",
        pause: "Pause",
        stop: "Stop",
        copy: "Copy",
        downloadTxt: "Download .txt",
        startOver: "Start over",
        currentLanguage: "Current language:",
        wizardHint: "Wizard: press Shift+W â€¢ {value}",
        wizardPanel: "Wizard Panel (Shift+W)",
        close: "Close",
        presetReading: "Preset: Reading",
        presetUnderstanding: "Preset: Understanding",
        toggleOriginal: "Toggle Original",
        themeSepiaButton: "Theme: Sepia",
        wozPlaceholder: "Paste a prewritten summary to replace outputâ€¦",
        replaceSimplified: "Replace simplified",
        useComputed: "Use computed output",
      },
      hi: {
        docTitle: "à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤¸à¤¿à¤‚à¤ªà¥à¤²à¤¿à¤«à¤¾à¤¯à¤° â€” WoZ v3 (à¤¶à¥‡à¤¯à¤° à¤•à¤°à¤¨à¥‡ à¤¯à¥‹à¤—à¥à¤¯)",
        prototype: "à¤ªà¥à¤°à¥‹à¤Ÿà¥‹à¤Ÿà¤¾à¤‡à¤ª",
        subtitle: "à¤­à¤¾à¤·à¤¾-à¤¸à¤®à¤ à¤µà¤¾à¤²à¤¾, à¤ªà¥à¤°à¤¶à¥à¤¨à¤¾à¤µà¤²à¥€-à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶à¤¿à¤¤ à¤¸à¤‚à¤•à¥à¤·à¥‡à¤ª â€¢ TTS â€¢ à¤ªà¤ à¤¨ à¤¸à¤¹à¤¾à¤¯à¤• â€¢ WoZ",
        chooseLanguage: "à¤…à¤ªà¤¨à¥€ à¤­à¤¾à¤·à¤¾ à¤šà¥à¤¨à¥‡à¤‚",
        welcome: "à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ",
        continueGuest: "à¤…à¤¤à¤¿à¤¥à¤¿ à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚",
        login: "à¤²à¥‰à¤— à¤‡à¤¨",
        createAccount: "à¤–à¤¾à¤¤à¤¾ à¤¬à¤¨à¤¾à¤à¤",
        guestHint: "à¤…à¤¤à¤¿à¤¥à¤¿ à¤®à¥‹à¤¡ à¤•à¥‡à¤µà¤² à¤‡à¤¸ à¤¡à¤¿à¤µà¤¾à¤‡à¤¸ à¤ªà¤° à¤†à¤ªà¤•à¥€ à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸ à¤¸à¤‚à¤—à¥à¤°à¤¹à¥€à¤¤ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆà¥¤",
        whatsHarder: "à¤•à¥à¤¯à¤¾ à¤•à¤ à¤¿à¤¨ à¤¹à¥ˆ?",
        readingText: "à¤ªà¤¾à¤  à¤ªà¤¢à¤¼à¤¨à¤¾",
        readingHint: "à¤…à¤•à¥à¤·à¤° à¤¬à¤¹à¥à¤¤ à¤›à¥‹à¤Ÿà¥‡/à¤­à¥€à¤¡à¤¼ à¤µà¤¾à¤²à¥‡",
        understanding: "à¤…à¤°à¥à¤¥ à¤¸à¤®à¤à¤¨à¤¾",
        understandingHint: "à¤²à¤‚à¤¬à¥‡ à¤µà¤¾à¤•à¥à¤¯ / à¤¶à¤¬à¥à¤¦à¤œà¤¾à¤²",
        getsInTheWay: "à¤•à¥à¤¯à¤¾ à¤•à¤¾à¤® à¤®à¥‡à¤‚ à¤¬à¤¾à¤§à¤¾ à¤¡à¤¾à¤²à¤¤à¤¾ à¤¹à¥ˆ? (à¤¸à¤¬ à¤šà¥à¤¨à¥‡à¤‚)",
        obstacles: {
          small: "à¤›à¥‹à¤Ÿà¤¾ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ",
          tight: "à¤˜à¤¨à¥€ à¤ªà¤‚à¤•à¥à¤¤à¤¿à¤¯à¤¾à¤",
          dense: "à¤˜à¤¨à¥‡ à¤…à¤¨à¥à¤šà¥à¤›à¥‡à¤¦",
          complex: "à¤œà¤Ÿà¤¿à¤² à¤¶à¤¬à¥à¤¦",
          long: "à¤²à¤‚à¤¬à¥‡ à¤µà¤¾à¤•à¥à¤¯",
          busy: "à¤µà¥à¤¯à¤¸à¥à¤¤ à¤²à¥‡à¤†à¤‰à¤Ÿ",
        },
        previewSettings: "à¤…à¤ªà¤¨à¥€ à¤†à¤°à¤¾à¤®à¤¦à¤¾à¤¯à¤• à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤— à¤¦à¥‡à¤–à¥‡à¤‚",
        textSize: "à¤ªà¤¾à¤  à¤†à¤•à¤¾à¤°: {value}px",
        lineSpacing: "à¤²à¤¾à¤‡à¤¨ à¤¸à¥à¤ªà¥‡à¤¸à¤¿à¤‚à¤—: {value}",
        letterSpacing: "à¤…à¤•à¥à¤·à¤° à¤¦à¥‚à¤°à¥€: {value}%",
        readAloudQuestion: "à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤ªà¤°à¤¿à¤£à¤¾à¤® à¤¸à¥à¤•à¥à¤°à¥€à¤¨ à¤ªà¤° à¤‡à¤¸à¥‡ à¤ªà¤¢à¤¼à¤¾ à¤¹à¥à¤† à¤¸à¥à¤¨à¤¨à¤¾ à¤šà¤¾à¤¹à¥‡à¤‚à¤—à¥‡?",
        back: "à¤µà¤¾à¤ªà¤¸",
        skip: "à¤›à¥‹à¤¡à¤¼à¥‡à¤‚",
        next: "à¤†à¤—à¥‡",
        addYourText: "à¤…à¤ªà¤¨à¤¾ à¤ªà¤¾à¤  à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
        pasteText: "à¤ªà¥‡à¤¸à¥à¤Ÿ à¤•à¤°à¥‡à¤‚",
        uploadFile: "à¤«à¤¼à¤¾à¤‡à¤² à¤…à¤ªà¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚",
        pastePlaceholder: "à¤¯à¤¹à¤¾à¤ à¤…à¤ªà¤¨à¤¾ à¤ªà¤¾à¤  à¤ªà¥‡à¤¸à¥à¤Ÿ à¤•à¤°à¥‡à¤‚â€¦",
        uploadHint: "(à¤ªà¥à¤°à¥‹à¤Ÿà¥‹à¤Ÿà¤¾à¤‡à¤ª à¤•à¥‡à¤µà¤² .txt à¤«à¤¼à¤¾à¤‡à¤²à¥‹à¤‚ à¤•à¤¾ à¤¸à¤®à¤°à¥à¤¥à¤¨ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ)",
        loaded: "à¤²à¥‹à¤¡ à¤¹à¥à¤†:",
        summaryLength: "à¤¸à¤¾à¤°à¤¾à¤‚à¤¶ à¤²à¤‚à¤¬à¤¾à¤ˆ: {value} à¤¶à¤¬à¥à¤¦",
        simplifyVocab: "à¤¶à¤¬à¥à¤¦à¤¾à¤µà¤²à¥€ à¤¸à¤°à¤² à¤¬à¤¨à¤¾à¤à¤‚",
        splitLongSentences: "à¤²à¤‚à¤¬à¥‡ à¤µà¤¾à¤•à¥à¤¯à¥‹à¤‚ à¤•à¥‹ à¤…à¤²à¤— à¤•à¤°à¥‡à¤‚",
        simplifyAction: "à¤¸à¤°à¤²à¥€à¤•à¥ƒà¤¤ à¤•à¤°à¥‡à¤‚",
        workingOnIt: "à¤•à¤¾à¤°à¥à¤¯ à¤šà¤² à¤°à¤¹à¤¾ à¤¹à¥ˆâ€¦",
        progressUploading: "à¤…à¤ªà¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ",
        progressAnalyzing: "à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤•à¤° à¤°à¤¹à¤¾ à¤¹à¥ˆ",
        progressSimplifying: "à¤¸à¤°à¤²à¥€à¤•à¥ƒà¤¤ à¤•à¤° à¤°à¤¹à¤¾ à¤¹à¥ˆ",
        progressApplying: "à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤•à¤¤à¤¾à¤à¤ à¤²à¤¾à¤—à¥‚ à¤•à¤° à¤°à¤¹à¤¾ à¤¹à¥ˆ",
        progressFinalizing: "à¤…à¤‚à¤¤à¤¿à¤® à¤°à¥‚à¤ª à¤¦à¥‡ à¤°à¤¹à¤¾ à¤¹à¥ˆ",
        detectedLanguage: "à¤ªà¤¹à¤šà¤¾à¤¨à¥€ à¤—à¤ˆ à¤­à¤¾à¤·à¤¾:",
        yourSimplifiedText: "à¤†à¤ªà¤•à¤¾ à¤¸à¤°à¤²à¥€à¤•à¥ƒà¤¤ à¤ªà¤¾à¤ ",
        themeLight: "à¤²à¤¾à¤‡à¤Ÿ",
        themeSepia: "à¤¸à¥‡à¤ªà¤¿à¤¯à¤¾",
        themeDark: "à¤¡à¤¾à¤°à¥à¤•",
        original: "à¤®à¥‚à¤²",
        simplified: "à¤¸à¤°à¤²à¥€à¤•à¥ƒà¤¤",
        empty: "(à¤–à¤¾à¤²à¥€)",
        noOutput: "(à¤•à¥‹à¤ˆ à¤†à¤‰à¤Ÿà¤ªà¥à¤Ÿ à¤¨à¤¹à¥€à¤‚) à¤ªà¤¾à¤  à¤ªà¥‡à¤¸à¥à¤Ÿ à¤•à¤°à¥‡à¤‚ à¤”à¤° 'à¤¸à¤°à¤²à¥€à¤•à¥ƒà¤¤ à¤•à¤°à¥‡à¤‚' à¤ªà¤° à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚à¥¤",
        readingAssists: "à¤ªà¤ à¤¨ à¤¸à¤¹à¤¾à¤¯à¤•",
        enableAssists: "à¤¸à¤¹à¤¾à¤¯à¤• à¤¸à¤•à¥à¤·à¤® à¤•à¤°à¥‡à¤‚ (à¤ªà¤¹à¤²à¥‡ vará¹‡a à¤¬à¥‹à¤²à¥à¤¡ à¤•à¤°à¥‡à¤‚)",
        firstVarna: "à¤ªà¤¹à¤²à¤¾ vará¹‡a à¤¬à¥‹à¤²à¥à¤¡ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤: {value}",
        hindiCharAssists: "à¤¹à¤¿à¤¨à¥à¤¦à¥€ à¤ªà¤¾à¤¤à¥à¤° à¤¸à¤¹à¤¾à¤¯ (à¤• / à¤µ)",
        assistsDescription: "à¤¸à¤¹à¤¾à¤¯à¤• à¤ªà¥à¤°à¤¤à¥à¤¯à¥‡à¤• à¤¶à¤¬à¥à¤¦ à¤•à¥‡ à¤ªà¤¹à¤²à¥‡ à¤•à¥à¤› vará¹‡a (à¤—à¥à¤°à¥ˆà¤«à¥€à¤®à¥à¤¸) à¤•à¥‹ à¤¬à¥‹à¤²à¥à¤¡ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚, à¤”à¤° â€” à¤¹à¤¿à¤¨à¥à¤¦à¥€ à¤•à¥‡ à¤²à¤¿à¤ â€” à¤•à¥à¤› à¤…à¤•à¥à¤·à¤°à¥‹à¤‚ à¤•à¥‹ à¤°à¥ˆà¤ª à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤¤à¤¾à¤•à¤¿ à¤¡à¥‡à¤µà¤²à¤ªà¤°à¥à¤¸ à¤µà¥ˆà¤•à¤²à¥à¤ªà¤¿à¤• à¤—à¥à¤²à¤¿à¤«à¤¼ à¤œà¥‹à¤¡à¤¼ à¤¸à¤•à¥‡à¤‚à¥¤",
        readAloud: "à¤‰à¤šà¥à¤šà¤¾à¤°à¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
        resume: "à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚",
        pause: "à¤°à¥‹à¤•à¥‡à¤‚",
        stop: "à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚",
        copy: "à¤•à¥‰à¤ªà¥€",
        downloadTxt: "à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ .txt",
        startOver: "à¤ªà¥à¤¨à¤ƒ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚",
        currentLanguage: "à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤­à¤¾à¤·à¤¾:",
        wizardHint: "à¤µà¤¿à¤œà¤¼à¤¾à¤°à¥à¤¡: Shift+W à¤¦à¤¬à¤¾à¤à¤‚ â€¢ {value}",
        wizardPanel: "à¤µà¤¿à¤œà¤¼à¤¾à¤°à¥à¤¡ à¤ªà¥ˆà¤¨à¤² (Shift+W)",
        close: "à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚",
        presetReading: "à¤ªà¥à¤°à¤¿à¤¸à¥‡à¤Ÿ: à¤ªà¤ à¤¨",
        presetUnderstanding: "à¤ªà¥à¤°à¤¿à¤¸à¥‡à¤Ÿ: à¤¸à¤®à¤à¤¨à¤¾",
        toggleOriginal: "à¤®à¥‚à¤² à¤Ÿà¥‰à¤—à¤² à¤•à¤°à¥‡à¤‚",
        themeSepiaButton: "à¤¥à¥€à¤®: à¤¸à¥‡à¤ªà¤¿à¤¯à¤¾",
        wozPlaceholder: "à¤†à¤‰à¤Ÿà¤ªà¥à¤Ÿ à¤¬à¤¦à¤²à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤²à¤¿à¤–à¤¾ à¤—à¤¯à¤¾ à¤¸à¤¾à¤° à¤¯à¤¹à¤¾à¤ à¤ªà¥‡à¤¸à¥à¤Ÿ à¤•à¤°à¥‡à¤‚â€¦",
        replaceSimplified: "à¤¸à¤°à¤²à¥€à¤•à¥ƒà¤¤ à¤¬à¤¦à¤²à¥‡à¤‚",
        useComputed: "à¤—à¤£à¤¨à¤¾ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾ à¤†à¤‰à¤Ÿà¤ªà¥à¤Ÿ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚",
      },
      te: {
        docTitle: "à°Ÿà±†à°•à±à°¸à± à°Ÿà± à°¸à°¿à°‚à°ªà±à°²à°¿à°«à°¯à°°à± â€” WoZ v3 (à°·à±‡à°°à± à°šà±‡à°¯à°—à°²)",
        prototype: "à°ªà±à°°à±‹à°Ÿà±‹à°Ÿà±ˆà°ªà±",
        subtitle: "à°­à°¾à°·à°¾à°ªà°°à°®à±ˆà°¨, à°ªà±à°°à°¶à±à°¨à°¾à°µà°³à°¿-à°®à°¾à°°à±à°—à°¦à°°à±à°¶à°• à°¸à°‚à°•à±à°·à±‡à°ªà°‚ â€¢ TTS â€¢ à°ªà° à°¨à°‚ à°¸à°¹à°¾à°¯à°¾à°²à± â€¢ WoZ",
        chooseLanguage: "à°®à±€ à°­à°¾à°·à°¨à± à°Žà°‚à°šà±à°•à±‹à°‚à°¡à°¿",
        welcome: "à°¸à±à°µà°¾à°—à°¤à°‚",
        continueGuest: "à°…à°¤à°¿à°¥à°¿ à°—à°¾ à°•à±Šà°¨à°¸à°¾à°—à°‚à°¡à°¿",
        login: "à°²à°¾à°—à°¿à°¨à±",
        createAccount: "à°–à°¾à°¤à°¾ à°¸à±ƒà°·à±à°Ÿà°¿à°‚à°šà±",
        guestHint: "à°…à°¤à°¿à°¥à°¿ à°®à±‹à°¡à± à°®à±€ à°¸à±†à°Ÿà±à°Ÿà°¿à°‚à°—à±à°¸à± à°¨à± à°ˆ à°ªà°°à°¿à°•à°°à°‚à°²à±‹ à°®à°¾à°¤à±à°°à°®à±‡ à°¨à°¿à°²à±à°ªà±à°¤à±à°‚à°¦à°¿.",
        whatsHarder: "à°à°¦à°¿ à°•à°·à±à°Ÿà°‚?",
        readingText: "à°ªà°¾à° à±à°¯à°‚ à°šà°¦à°¿à°µà°¿ à°‰à°‚à°¡à°Ÿà°‚",
        readingHint: "à°…à°•à±à°·à°°à°¾à°²à± à°šà°¾à°²à°¾ à°šà°¿à°¨à±à°¨à°µà°¿à°—à°¾/à°˜à°¨à°‚à°—à°¾ à°‰à°¨à±à°¨à°¾à°¯à°¿",
        understanding: "à°…à°°à±à°¥à°‚ à°šà±‡à°¸à±à°•à±‹à°µà°¡à°‚",
        understandingHint: "à°ªà±†à°¦à±à°¦ à°µà°¾à°•à±à°¯à°¾à°²à±/à°œà°¾à°°à±à°—à°¨à±",
        getsInTheWay: "à°à°¦à°¿ à°¦à°¾à°°à°¿ à°²à±‹à°¨à±‡ à°‰à°‚à°¦à°¿? (à°…à°¨à±à°¨à°¿ à°Žà°‚à°šà±à°•à±‹à°‚à°¡à°¿)",
        obstacles: {
          small: "à°šà°¿à°¨à±à°¨ à°Ÿà±†à°•à±à°¸à±à°Ÿà±",
          tight: "à°˜à°¨ à°²à±ˆà°¨à± à°¸à±à°ªà±‡à°¸à°¿à°‚à°—à±",
          dense: "à°˜à°¨ à°ªà±‡à°°à°¾à°—à±à°°à°¾à°«à±à°¸à±",
          complex: "à°¸à°‚à°•à±à°²à°¿à°·à±à°Ÿ à°ªà°¦à°¾à°²à±",
          long: "à°ªà±Šà°¡à°µà±ˆà°¨ à°µà°¾à°•à±à°¯à°¾à°²à±",
          busy: "à°¬à°¿à°œà±€ à°²à±‡à°…à°µà±à°Ÿà±",
        },
        previewSettings: "à°®à±€ à°…à°¨à±à°•à±‚à°² à°¸à±†à°Ÿà±à°Ÿà°¿à°‚à°—à±à°¸à± à°ªà±‚à°°à±à°µà°¦à±ƒà°·à±à°Ÿà°¿",
        textSize: "à°Ÿà±†à°•à±à°¸à±à°Ÿà± à°ªà°°à°¿à°®à°¾à°£à°‚: {value}px",
        lineSpacing: "à°²à±ˆà°¨à± à°¸à±à°ªà±‡à°¸à°¿à°‚à°—à±: {value}",
        letterSpacing: "à°²à±‡à°–à°² à°®à°§à±à°¯ à°–à°¾à°³à±€: {value}%",
        readAloudQuestion: "à°«à°²à°¿à°¤à°¾à°² ÑÐºà±à°°à°¾à°¨à± à°²à±‹ à°¦à±€à°¨à±à°¨à°¿ à°ªà° à°¿à°‚à°šà°µà°²à°¸à°¿à°¨à°¦à°¾?",
        back: "à°µà±†à°¨à±à°•à°•à°¿",
        skip: "à°¦à°¾à°Ÿà°µà±‡à°¯à°¿",
        next: "à°¤à±†à°°à±à°µà±",
        addYourText: "à°®à±€ à°Ÿà±†à°•à±à°¸à±à°Ÿà± à°œà°¤ à°šà±‡à°¯à°‚à°¡à°¿",
        pasteText: "à°ªà±‡à°¸à±à°Ÿà± à°Ÿà±†à°•à±à°¸à±à°Ÿà±",
        uploadFile: "à°«à±ˆà°²à± à°…à°ªà±â€Œà°²à±‹à°¡à± à°šà±‡à°¯à°‚à°¡à°¿",
        pastePlaceholder: "à°‡à°•à±à°•à°¡ à°®à±€ à°Ÿà±†à°•à±à°¸à±à°Ÿà± à°ªà±‡à°¸à±à°Ÿà± à°šà±‡à°¯à°‚à°¡à°¿â€¦",
        uploadHint: "(à°ªà±à°°à±‹à°Ÿà±‹à°Ÿà±ˆà°ªà± .txt à°«à±ˆà°³à±à°²à°•à±‡ à°®à°¦à±à°¦à°¤à± à°‡à°¸à±à°¤à±à°‚à°¦à°¿)",
        loaded: "à°²à±‹à°¡à± à°…à°¯à°¿à°‚à°¦à°¿:",
        summaryLength: "à°¸à°¾à°°à°¾à°‚à°¶ à°ªà±Šà°¡à°µà±: {value} à°ªà°¦à°¾à°²à±",
        simplifyVocab: "à°ªà°¦à°œà°¾à°²à°¾à°¨à±à°¨à°¿ à°¸à°°à°³à±€à°•à°°à°¿à°‚à°šà±",
        splitLongSentences: "à°ªà±Šà°¡à°µà±ˆà°¨ à°µà°¾à°•à±à°¯à°¾à°²à°¨à± à°µà°¿à°¡à°—à±Šà°Ÿà±à°Ÿà±",
        simplifyAction: "à°¸à°°à°³à±€à°•à°°à°¿à°‚à°šà±",
        workingOnIt: "à°ªà°¨à°¿ à°œà°°à±à°—à±à°¤à±à°‚à°¦à°¿â€¦",
        progressUploading: "à°…à°ªà±â€Œà°²à±‹à°¡à± à°…à°µà±à°¤à±à°‚à°¦à°¿",
        progressAnalyzing: "à°µà°¿à°¶à±à°²à±‡à°·à°¿à°‚à°šà± à°šà±‡à°¸à±à°¤à±‹à°‚à°¦à°¿",
        progressSimplifying: "à°¸à°°à°³à±€à°•à°°à°¿à°‚à°šà± à°šà±‡à°¸à±à°¤à±‹à°‚à°¦à°¿",
        progressApplying: "à°ªà±à°°à°¾à°§à°¾à°¨à±à°¯à°¾à°²à°¨à± à°µà°°à±à°¤à°¿à°‚à°ªà°œà±‡à°¸à±à°¤à±‹à°‚à°¦à°¿",
        progressFinalizing: "à°šà°¿à°µà°°à°¿ à°°à±‚à°ªà°‚", 
        detectedLanguage: "à°¤à±†à°²à°¿à°¸à°¿à°¨ à°­à°¾à°·:",
        yourSimplifiedText: "à°®à±€ à°¸à°°à°³à±€à°•à±ƒà°¤ à°ªà°¾à° à±à°¯à°‚",
        themeLight: "à°²à±ˆà°Ÿà±",
        themeSepia: "à°¸à±†à°ªà°¿à°¯à°¾",
        themeDark: "à°¡à°¾à°°à±à°•à±",
        original: "à°®à±‚à°²à°‚",
        simplified: "à°¸à°°à°³à±€à°•à±ƒà°¤",
        empty: "(à°–à°¾à°³à±€)",
        noOutput: "(à° à°…à°µà±à°Ÿà±â€Œà°ªà±à°Ÿà± à°²à±‡à°¦à±) à°Ÿà±†à°•à±à°¸à±à°Ÿà±â€Œà°¨à± à°ªà±‡à°¸à±à°Ÿà± à°šà±‡à°¸à°¿ 'à°¸à°°à°³à±€à°•à°°à°¿à°‚à°šà±' à°ªà±ˆ à°•à±à°²à°¿à°•à± à°šà±‡à°¯à°‚à°¡à°¿.",
        readingAssists: "à°ªà° à°¨ à°¸à°¹à°¾à°¯à°¾à°²à±",
        enableAssists: "à°¸à°¹à°¾à°¯à°¾à°²à± à°Žà°¨à±‡à°¬à±à°²à± à°šà±‡à°¯à°‚à°¡à°¿ (à°®à±Šà°¦à°Ÿà°¿ vará¹‡a à°Žà°‚à°¤ à°¬à±‹à°²à±à°¡à± à°šà±‡à°¯à°¾à°²à°¿)",
        firstVarna: "à°®à±Šà°¦à°Ÿà°¿ vará¹‡a à°¬à±‹à°²à±à°¡à± à°šà±‡à°¯à°µà°²à°¸à°¿à°¨à°¦à°¿: {value}",
        hindiCharAssists: "à°¹à°¿à°‚à°¦à±€ à°…à°•à±à°·à°° à°¸à°¹à°¾à°¯à°¾à°²à± (à¤• / à¤µ)",
        assistsDescription: "à°ªà°¦à°‚ à°¯à±Šà°•à±à°• à°®à±Šà°¦à°Ÿà°¿ à°•à±Šà°¨à±à°¨à°¿ vará¹‡a (à°—à±à°°à°¾à°«à±€à°®à±)à°²à°¨à± à°¸à°¹à°¾à°¯à°¾à°²à± à°¬à±‹à°²à±à°¡à± à°šà±‡à°¸à±à°¤à°¾à°¯à°¿, à°…à°²à°¾à°—à±‡ â€” à°¹à°¿à°‚à°¦à±€à°•à°¿ â€” à°•à±Šà°¨à±à°¨à°¿ à°…à°•à±à°·à°°à°¾à°²à°¨à± à°°à±à°¯à°¾à°ªà± à°šà±‡à°¸à±à°¤à°¾à°¯à°¿.",
        readAloud: "à°µà°¾à°¯à°¿à°¸à± à°®à±†à°²à°•à±à°µ",
        resume: "à°ªà±à°¨à°ƒà°ªà±à°°à°¾à°°à°‚à°­à°¿à°‚à°šà±",
        pause: "à°ªà°¾à°œà±",
        stop: "à°¨à°¿à°²à°¿à°ªà°¿",
        copy: "à°•à°¾à°ªà±€",
        downloadTxt: "à°¡à±Œà°¨à±à°²à±‹à°¡à± .txt",
        startOver: "à°®à°³à±à°²à±€ à°ªà±à°°à°¾à°°à°‚à°­à°¿à°‚à°šà±",
        currentLanguage: "à°ªà±à°°à°¸à±à°¤à±à°¤ à°­à°¾à°·:",
        wizardHint: "à°µà°¿à°œà°¾à°°à±à°¡à±: Shift+W à°¨à±Šà°•à±à°•à°‚à°¡à°¿ â€¢ {value}",
        wizardPanel: "à°µà°¿à°œà°¾à°°à±à°¡à± à°ªà±à°¯à°¾à°¨à±†à°²à± (Shift+W)",
        close: "à°µà±†à°¯à±à°¯à°¿",
        presetReading: "à°ªà±à°°à±€à°¸à±†à°Ÿà±: à°ªà° à°¨à°‚",
        presetUnderstanding: "à°ªà±à°°à±€à°¸à±†à°Ÿà±: à°…à°°à±à°§à°‚",
        toggleOriginal: "à°®à±‚à°²à°¾à°¨à±à°¨à°¿ à°Ÿà°¾à°—à±à°²à± à°šà±‡à°¯à°‚à°¡à°¿",
        themeSepiaButton: "à°¥à±€à°®à±: à°¸à±†à°ªà°¿à°¯à°¾",
        wozPlaceholder: "à°«à°²à°¿à°¤à°¾à°¨à±à°¨à°¿ à°®à°¾à°°à±à°šà°¡à°¾à°¨à°¿à°•à°¿ à°‡à°•à±à°•à°¡ à°®à±à°‚à°¦à±à°—à°¾ à°°à°¾à°¸à°¿à°¨ à°¸à°¾à°°à°¾à°‚à°¶à°¾à°¨à±à°¨à°¿ à°ªà±‡à°¸à±à°Ÿà± à°šà±‡à°¯à°‚à°¡à°¿â€¦",
        replaceSimplified: "à°¸à°°à°³à±€à°•à±ƒà°¤ à°¬à°¦à°¿à°²à±€ à°šà±‡à°¯à°‚à°¡à°¿",
        useComputed: "à°²à±†à°•à±à°•à°¿à°‚à°šà°¿à°¨ à°…à°µà±à°Ÿà±â€Œà°ªà±à°Ÿà± à°‰à°ªà°¯à±‹à°—à°¿à°‚à°šà±",
      },
      gu: {
        docTitle: "àªŸà«‡àª•à«àª¸à«àªŸ àª¸àª¿àª®à«àªªà«àª²àª¿àª«àª¾àª¯àª° â€” WoZ v3 (àª¶à«‡àª°à«‡àª¬àª²)",
        prototype: "àªªà«àª°à«‹àªŸà«‹àªŸàª¾àª‡àªª",
        subtitle: "àª­àª¾àª·àª¾-{àª¸àªœàª¾àª—}, àªªà«àª°àª¶à«àª¨àª¾àªµàª³à«€-àª®àª¾àª°à«àª—àª¦àª°à«àª¶àª¿àª¤ àª¸àª¾àª°àª¾àª‚àª¶ â€¢ TTS â€¢ àªµàª¾àª‚àªšàª¨ àª¸àª¹àª¾àª¯ â€¢ WoZ",
        chooseLanguage: "àª¤àª®àª¾àª°à«€ àª­àª¾àª·àª¾ àªªàª¸àª‚àª¦ àª•àª°à«‹",
        welcome: "àª¸à«àªµàª¾àª—àª¤",
        continueGuest: "àª…àª¤àª¿àª¥àª¿ àª¤àª°à«€àª•à«‡ àªšàª¾àª²à« àª°àª¾àª–à«‹",
        login: "àª²à«‰àª—àª¿àª¨",
        createAccount: "àª–àª¾àª¤à«àª‚ àª¬àª¨àª¾àªµà«‹",
        guestHint: "àª…àª¤àª¿àª¥àª¿ àª®à«‹àª¡ àª«àª•à«àª¤ àª† àª¡àª¿àªµàª¾àªˆàª¸ àªªàª° àª¤àª®àª¾àª°à«€ àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àª¸àª¾àªšàªµà«‡ àª›à«‡.",
        whatsHarder: "àª¶à«àª‚ àª®à«àª¶à«àª•à«‡àª² àª›à«‡?",
        readingText: "àªŸà«‡àª•à«àª¸à«àªŸ àªµàª¾àª‚àªšàªµà«àª‚",
        readingHint: "àª…àª•à«àª·àª°à«‹ àª–à«‚àª¬ àª¨àª¾àª¨à«àª‚ / àª­à«€àª¡àªµàª¾àª³à«àª‚",
        understanding: "àª…àª°à«àª¥ àª¸àª®àªœàªµà«‹",
        understandingHint: "àª²àª¾àª‚àª¬àª¾ àªµàª¾àª•à«àª¯ / àªœàª¾àª°àªµàª¾àª¨à«‹",
        getsInTheWay: "àª¶à«àª‚ àª®àª¾àª°à«àª—àª®àª¾àª‚ àª†àªµà«‡ àª›à«‡? (àª¬àª§àª¾ àªªàª¸àª‚àª¦ àª•àª°à«‹)",
        obstacles: {
          small: "àª¨àª¾àª¨à«àª‚ àªŸà«‡àª•à«àª¸à«àªŸ",
          tight: "àª¸à«€àª§à«€ àª²àª¾àªˆàª¨ àª¸à«àªªà«‡àª¸àª¿àª‚àª—",
          dense: "àª—àª¾àª¢ àªªà«‡àª°àª¾àª—à«àª°àª¾àª«à«àª¸",
          complex: "àªœàªŸàª¿àª² àª¶àª¬à«àª¦à«‹",
          long: "àª²àª¾àª‚àª¬àª¾ àªµàª¾àª•à«àª¯à«‹",
          busy: "àªµà«àª¯àª¸à«àª¤ àª²à«‡àª†àª‰àªŸ",
        },
        previewSettings: "àª¤àª®àª¾àª°à«€ àª†àª°àª¾àª®àª¦àª¾àª¯àª• àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àªªà«àª°àª¿àªµà«àª¯à«‚ àª•àª°à«‹",
        textSize: "àªŸà«‡àª•à«àª¸à«àªŸ àª¸àª¾àªˆàª: {value}px",
        lineSpacing: "àª²àª¾àª‡àª¨ àª¸à«àªªà«‡àª¸àª¿àª‚àª—: {value}",
        letterSpacing: "àª…àª•à«àª·àª° àª…àª‚àª¤àª°: {value}%",
        readAloudQuestion: "àª†àª‰àªŸàªªà«àªŸ àª¸à«àª•à«àª°à«€àª¨ àªªàª° àª¤à«‡àª¨à«‡ àªµàª¾àª‚àªšàªµàª¾ àª®àª¾àª‚àª—à«‹ àª›à«‹?",
        back: "àªªàª¾àª›àª³",
        skip: "àª¸à«àª•àª¿àªª",
        next: "àª…àª—àª¾àª‰",
        addYourText: "àª¤àª®àª¾àª°à«‹ àªŸà«‡àª•à«àª¸à«àªŸ àª‰àª®à«‡àª°à«‹",
        pasteText: "àªªà«‡àª¸à«àªŸ àªŸà«‡àª•à«àª¸à«àªŸ",
        uploadFile: "àª«àª¾àª‡àª² àª…àªªàª²à«‹àª¡ àª•àª°à«‹",
        pastePlaceholder: "àª…àª¹à«€àª‚ àª¤àª®àª¾àª°à«‹ àªŸà«‡àª•à«àª¸à«àªŸ àªªà«‡àª¸à«àªŸ àª•àª°à«‹â€¦",
        uploadHint: "(àªªà«àª°à«‹àªŸà«‹àªŸàª¾àª‡àªª àª«àª•à«àª¤ .txt àª«àª¾àªˆàª²à«‹àª¨à«‡ àª¸àªªà«‹àª°à«àªŸ àª•àª°à«‡ àª›à«‡)",
        loaded: "àª²à«‹àª¡ àª¥àª¯à«àª‚:",
        summaryLength: "àª¸àª¾àª°àª¾àª‚àª¶ àª²àª‚àª¬àª¾àªˆ: {value} àª¶àª¬à«àª¦à«‹",
        simplifyVocab: "àª¶àª¬àª¦àª­àª‚àª¡à«‹àª³ àª¸àª°àª³ àª•àª°à«‹",
        splitLongSentences: "àª²àª¾àª‚àª¬àª¾ àªµàª¾àª•à«àª¯à«‹ àªµàª¹à«‡àª‚àªšà«‹",
        simplifyAction: "àª¸àª°àª³à«€àª•à«ƒàª¤ àª•àª°à«‹",
        workingOnIt: "àª•àª¾àª°à«àª¯ àªšàª¾àª²à« àª›à«‡â€¦",
        progressUploading: "àª…àªªàª²à«‹àª¡ àª•àª°à«€ àª°àª¹à«àª¯à«àª‚ àª›à«‡",
        progressAnalyzing: "àªµàª¿àª¶à«àª²à«‡àª·àª£ àª•àª°à«€ àª°àª¹à«àª¯à«àª‚ àª›à«‡",
        progressSimplifying: "àª¸àª°àª³à«€àª•à«ƒàª¤ àª•àª°à«€ àª°àª¹à«àª¯à«àª‚ àª›à«‡",
        progressApplying: "àªµàª°à«€àª¤à«€àª“ àª²àª¾àª—à« àª•àª°à«€ àª°àª¹à«€ àª›à«‡",
        progressFinalizing: "àª†àª–àª°à«€àª•àª°àª£",
        detectedLanguage: "àªªàª¹à«‡àªšàª¾àª¨ àª¥àª¯à«‡àª²à«€ àª­àª¾àª·àª¾:",
        yourSimplifiedText: "àª¤àª®àª¾àª°à«àª‚ àª¸àª°àª³à«€àª•à«ƒàª¤ àª²àª–àª¾àª£",
        themeLight: "àª²àª¾àª‡àªŸ",
        themeSepia: "àª¸à«‡àªªàª¿àª¯àª¾",
        themeDark: "àª¡àª¾àª°à«àª•",
        original: "àª®à«‚àª³",
        simplified: "àª¸àª°àª³à«€àª•à«ƒàª¤",
        empty: "(àª–àª¾àª²à«€)",
        noOutput: "(àª†àª‰àªŸàªªà«àªŸ àª¨àª¥à«€) àªŸà«‡àª•à«àª¸à«àªŸ àªªà«‡àª¸à«àªŸ àª•àª°à«‹ àª…àª¨à«‡ 'àª¸àª°àª³à«€àª•à«ƒàª¤' àªªàª° àª•à«àª²àª¿àª• àª•àª°à«‹.",
        readingAssists: "àªµàª¾àª‚àªšàª¨ àª¸àª¹àª¾àª¯",
        enableAssists: "àª¸àª¹àª¾àª¯ àª¸àª•à«àª°àª¿àª¯ àª•àª°à«‹ (àªªà«àª°àª¥àª® vará¹‡a àª¬à«‹àª²à«àª¡ àª•àª°à«‹)",
        firstVarna: "àªªà«àª°àª¥àª® vará¹‡a àª¬à«‹àª²à«àª¡ àª•àª°àªµàª¾ àª®àª¾àªŸà«‡: {value}",
        hindiCharAssists: "àª¹àª¿àª¨à«àª¦à«€ àª…àª•à«àª·àª° àª¸àª¹àª¾àª¯ (à¤• / à¤µ)",
        assistsDescription: "àª¸àª¹àª¾àª¯ àª¦àª°à«‡àª• àª¶àª¬à«àª¦àª¨àª¾ àªªàª¹à«‡àª²àª¾ àª•à«‡àªŸàª²àª¾àª• vará¹‡a (àª—à«àª°àª¾àª«à«€àª®à«àª¸)àª¨à«‡ àª¬à«‹àª²à«àª¡ àª•àª°à«‡ àª›à«‡, àª…àª¨à«‡ â€” àª¹àª¿àª¨à«àª¦à«€ àª®àª¾àªŸà«‡ â€” àª¨àª¿àª¯àª¤ àª…àª•à«àª·àª°à«‹àª¨à«‡ àª°à«‡àªª àª•àª°à«‡ àª›à«‡ àªœà«‡àª¥à«€ àª¡à«‡àªµàª²àªªàª° àªµàª¿àª•àª²à«àªªàª¿àª• àª—à«àª²àª¾àªˆàª« àª¸à«‡àªŸ àª•àª°à«€ àª¶àª•à«‡.",
        readAloud: "àªµàª¾àªšà«‹",
        resume: "àªªà«àª¨àªƒ àª¶àª°à«‚ àª•àª°à«‹",
        pause: "àªµàª¿àª°àª¾àª®",
        stop: "àª¬àª‚àª§",
        copy: "àª•à«‹àªªà«€",
        downloadTxt: "àª¡àª¾àª‰àª¨àª²à«‹àª¡ .txt",
        startOver: "àª«àª°à«€ àª¶àª°à«‚ àª•àª°à«‹",
        currentLanguage: "àªµàª°à«àª¤àª®àª¾àª¨ àª­àª¾àª·àª¾:",
        wizardHint: "àªµàª¿àªàª°à«àª¡: Shift+W àª¦àª¬àª¾àªµà«‹ â€¢ {value}",
        wizardPanel: "àªµàª¿àªàª°à«àª¡ àªªà«‡àª¨àª² (Shift+W)",
        close: "àª¬àª‚àª§ àª•àª°à«‹",
        presetReading: "àªªà«àª°àª¿àª¸à«‡àªŸ: àª°à«€àª¡àª¿àª‚àª—",
        presetUnderstanding: "àªªà«àª°àª¿àª¸à«‡àªŸ: àª¸àª®àªœàªµà«àª‚",
        toggleOriginal: "àª®à«‚àª³ àªŸà«‰àª—àª² àª•àª°à«‹",
        themeSepiaButton: "àª¥à«€àª®: àª¸à«‡àªªàª¿àª¯àª¾",
        wozPlaceholder: "àª†àª‰àªŸàªªà«àªŸ àª¬àª¦àª²à«‹ àª®àª¾àªŸà«‡ àªªàª¹à«‡àª²à«‡àª¥à«€ àª²àª–à«‡àª² àª¸àª¾àª°àª¾àª‚àª¶ àª…àª¹à«€àª‚ àªªà«‡àª¸à«àªŸ àª•àª°à«‹â€¦",
        replaceSimplified: "àª¸àª°àª²à«€àª•à«ƒàª¤ àª¬àª¦àª²à«‹",
        useComputed: "àª—àª£àª¿àª¤àª†àª§àª¾àª°àª¿àª¤ àª†àª‰àªŸàªªà«àªŸ àª‰àªªàª¯à«‹àª— àª•àª°à«‹",
      }
    };

    function t(key, vars={}){
      const langCode = (window.__app_lang_code__ || 'en');
      const parts = key.split('.');
      let val = TRANSLATIONS[langCode] ?? TRANSLATIONS['en'];
      for(const p of parts){ if (val && val[p] !== undefined) val = val[p]; else { val = undefined; break; } }
      if (val === undefined) {
        // fallback to english
        val = TRANSLATIONS['en'];
        for(const p of parts){ if (val && val[p] !== undefined) val = val[p]; else { val = undefined; break; } }
      }
      if (typeof val !== 'string') return '';
      return val.replace(/\{(\w+)\}/g, (_, name) => (vars[name] !== undefined ? String(vars[name]) : '{'+name+'}'));
    }

    const THEME_CLASSES = {
      light: "bg-white text-zinc-900",
      sepia: "bg-[#F4ECD8] text-zinc-900",
      dark: "bg-zinc-900 text-zinc-100",
    };

    const clamp = (v, min, max) => Math.min(max, Math.max(min, v));
    const cx = (...arr) => arr.filter(Boolean).join(" ");

    function simplifyText(original, targetWords, opts) {
      if (!original) return "";
      let txt = original.replace(/\\s+/g, " ").replace(/\\[[^\\]]*\\]|\\([^\\)]*\\)/g, "").trim();
      let sentences = txt.split(/(?<=[\\.\\!\\?])\\s+/);
      if (opts.splitLongSentences) {
        sentences = sentences.flatMap(s => {
          if (s.length < 140) return [s];
          return s.split(/,\\s+/).map((chunk, i, arr) => (i < arr.length - 1 ? chunk + "." : chunk));
        });
      }
      if (opts.simplifyVocab) {
        const map = { approximately:"about", therefore:"so", consequently:"so", demonstrate:"show", however:"but", furthermore:"also", nevertheless:"still" };
        sentences = sentences.map(s => s.replace(/\\b([a-z]{4,})\\b/gi, m => map[m.toLowerCase()] ?? m));
      }
      const words = sentences.join(" ").split(/\\s+/);
      const target = clamp(Math.round(targetWords), 10, 600);
      const trimmed = words.slice(0, target).join(" ");
      return trimmed + (words.length > target ? "â€¦" : "");
    }

    async function readTextFile(file) {
      if (!file.name.toLowerCase().endsWith(".txt")) throw new Error("For this prototype, please upload a .txt file.");
      return await file.text();
    }

    // ---------- Dyslexia/ADHD assist rendering ----------
    function makeSegmenter(langCode) {
      try { return new Intl.Segmenter(langCode, { granularity: "grapheme" }); }
      catch { return new Intl.Segmenter("en", { granularity: "grapheme" }); }
    }
    function toGraphemes(text, seg) {
      const it = seg.segment(text)[Symbol.iterator]();
      const out = []; let n = it.next();
      while (!n.done) { out.push(n.value.segment || ""); n = it.next(); }
      return out;
    }
    const HINDI_CHAR_ASSIST = new Map([
      ["à¤•","df-ka"], ["à¤µ","df-va"], ["à¤°","df-ra"], ["à¤¹","df-ha"], ["à¤¿","df-i"],
    ]);

    // A few Telugu characters to mark for devs to alter glyphs / styling if desired
    const TELUGU_CHAR_ASSIST = new Map([
      ["à°…","df-ta"], ["à°†","df-taa"], ["à°‡","df-ti"], ["à°‰","df-tu"], ["à°µ","df-tva"],
    ]);

    // A few Gujarati characters
    const GUJARATI_CHAR_ASSIST = new Map([
      ["àª•","df-ga"], ["àª—","df-gg"], ["àªµ","df-gva"], ["àª¾","df-aa"], ["àª¿","df-i"],
    ]);

    const CHAR_ASSISTS_BY_LANG = {
      hi: HINDI_CHAR_ASSIST,
      te: TELUGU_CHAR_ASSIST,
      gu: GUJARATI_CHAR_ASSIST,
    };

    function renderAssistiveNodes(text, langCode, opts) {
      const seg = makeSegmenter(langCode);
      const tokens = text.split(/(\\s+)/);
      const nodes = tokens.map((tok, i) => {
        if (/^\\s+$/.test(tok)) return <span key={"sp-"+i}>{tok}</span>;
        const clusters = toGraphemes(tok, seg);
        const deco = (g, j) => {
          if (opts.enableCharAssist) {
            const map = CHAR_ASSISTS_BY_LANG[langCode];
            if (map && map.has(g)) {
              const cls = map.get(g);
              // Use font-semibold so assisted characters render bold (instead of the previous dotted underline)
              return <span key={"g-"+i+"-"+j} className={"df-char "+cls+" font-semibold"}>{g}</span>;
            }
          }
          return <span key={"g-"+i+"-"+j}>{g}</span>;
        };
        const head = clusters.slice(0, opts.boldFirstN).map(deco);
        const tail = clusters.slice(opts.boldFirstN).map(deco);
        return <span key={"w-"+i} className="df-word"><strong className="df-head font-semibold">{head}</strong>{tail}</span>;
      });
      return <>{nodes}</>;
    }

    // ---------------- Small UI bits ----------------
    const Section = ({ title, className, children }) => (
      <section className={cx("rounded-2xl border border-violet-200 p-5 shadow-sm", className)}>
        {title && <h2 className="mb-3 text-xl font-semibold text-violet-900">{title}</h2>}
        {children}
      </section>
    );
    const Chip = ({ selected, onClick, children }) => (
      <button onClick={onClick} className={cx("rounded-full border px-3 py-1 text-sm transition", selected ? "border-violet-600 bg-violet-600 text-white" : "border-zinc-300 bg-white text-zinc-700 hover:border-violet-400")}>
        {children}
      </button>
    );
    const Range = ({ min, max, step=1, value, onChange, ariaLabel }) => (
      <input aria-label={ariaLabel} type="range" min={min} max={max} step={step} value={value} onChange={(e)=>onChange(Number(e.target.value))} className="h-2 w-full cursor-pointer appearance-none rounded-full bg-violet-200 accent-violet-600" />
    );

    function App() {
      const [step, setStep] = useState("language");
      const [lang, setLang] = useState(LANGS[0]);
      useEffect(() => {
        // keep t() helper in sync with selected language and update page title
        window.__app_lang_code__ = lang?.code || 'en';
        try { document.title = (TRANSLATIONS[lang?.code]?.docTitle) || TRANSLATIONS['en'].docTitle; } catch { }
      }, [lang]);
      const [authMode, setAuthMode] = useState(null);

      const [harder, setHarder] = useState(null);
      const [obstacles, setObstacles] = useState([]);
      const [prefFontPx, setPrefFontPx] = useState(18);
      const [prefLine, setPrefLine] = useState(1.6);
      const [prefLetter, setPrefLetter] = useState(0.02);
      const [ttsAutoplay, setTtsAutoplay] = useState(false);

      const [wozOpen, setWozOpen] = useState(false);
      const [wozDraft, setWozDraft] = useState("");
      const [forcedSimplified, setForcedSimplified] = useState(null);

      const [inputTab, setInputTab] = useState("paste");
      const [original, setOriginal] = useState("");
      const [uploadedFileName, setUploadedFileName] = useState(null);

      const [summaryLen, setSummaryLen] = useState(120);
      const [optSimplifyVocab, setOptSimplifyVocab] = useState(true);
      const [optSplitLong, setOptSplitLong] = useState(true);

      const [progress, setProgress] = useState(0);
      const [progressStage, setProgressStage] = useState(0);
  const PROGRESS_STEPS = ['progressUploading','progressAnalyzing','progressSimplifying','progressApplying','progressFinalizing'];

      const [theme, setTheme] = useState("light");
      const [fontPx, setFontPx] = useState(18);
      const [lineHeight, setLineHeight] = useState(1.7);
      const [letterSpacingEm, setLetterSpacingEm] = useState(0.02);
      const [weightBold, setWeightBold] = useState(false);
      const [showOriginal, setShowOriginal] = useState(true);

      const [assistOn, setAssistOn] = useState(true);
      const [boldFirstN, setBoldFirstN] = useState(2);
      const [charAssist, setCharAssist] = useState(true);

      const computedSimplified = React.useMemo(() => simplifyText(original, summaryLen, { splitLongSentences: optSplitLong, simplifyVocab: optSimplifyVocab }), [original, summaryLen, optSplitLong, optSimplifyVocab]);
      const outText = forcedSimplified ?? computedSimplified;

      // Detect simple HTML in the output and provide a minimal sanitizer
      const isHtmlString = (s) => typeof s === 'string' && /<\/?[a-z][\s\S]*>/i.test(s);
      const sanitizeHtml = (html) => {
        try {
          const tmp = document.createElement('div');
          tmp.innerHTML = html || '';
          const allowed = new Set(['STRONG','B','EM','I','U','BR','P','SPAN','DIV','UL','OL','LI','A']);
          function clean(node) {
            if (node.nodeType === Node.TEXT_NODE) return document.createTextNode(node.nodeValue || '');
            if (node.nodeType === Node.ELEMENT_NODE) {
              if (!allowed.has(node.nodeName)) {
                // recurse into children but skip this tag
                const frag = document.createDocumentFragment();
                node.childNodes.forEach(ch => {
                  const c = clean(ch); if (c) frag.appendChild(c);
                });
                return frag;
              }
              const el = document.createElement(node.nodeName.toLowerCase());
              // allow only safe hrefs on anchors
              if (node.nodeName === 'A') {
                const href = node.getAttribute('href') || '';
                if (/^(https?:|mailto:)/i.test(href)) el.setAttribute('href', href);
              }
              node.childNodes.forEach(ch => {
                const c = clean(ch); if (c) el.appendChild(c);
              });
              return el;
            }
            return document.createDocumentFragment();
          }
          const outFrag = document.createDocumentFragment();
          tmp.childNodes.forEach(ch => outFrag.appendChild(clean(ch)));
          const wrapper = document.createElement('div');
          wrapper.appendChild(outFrag);
          return wrapper.innerHTML;
        } catch (e) { return '' + (html || ''); }
      };

      useEffect(() => {
        if (step === "processing") {
          if (harder === "reading") {
            setFontPx(v => Math.max(v, Math.max(prefFontPx, 18)));
            setLineHeight(v => Math.max(v, Math.max(prefLine, 1.7)));
            setLetterSpacingEm(v => Math.max(v, Math.max(prefLetter, 0.02)));
            setWeightBold(obstacles.includes("dense") || obstacles.includes("small"));
          }
          if (harder === "understanding") {
            setOptSplitLong(true);
            setOptSimplifyVocab(true);
          }
          if (obstacles.includes("small")) setFontPx(v => Math.max(v, 20));
          if (obstacles.includes("tight")) setLineHeight(v => Math.max(v, 1.9));
          if (obstacles.includes("dense")) setLetterSpacingEm(v => Math.max(v, 0.03));
          if (obstacles.includes("complex")) setOptSimplifyVocab(true);
          if (obstacles.includes("long")) setOptSplitLong(true);
          if (obstacles.includes("busy")) { setShowOriginal(false); setTheme("sepia"); }
        }
      }, [step]);

      useEffect(() => {
        if (step !== "processing") return;
        setProgress(0); setProgressStage(0);
        const totalMs = 1600 + Math.min(4000, Math.max(0, original.length / 2));
        const start = performance.now();
        const raf = () => {
          const elapsed = performance.now() - start;
          const p = clamp(elapsed / totalMs, 0, 1);
          setProgress(Math.round(p * 100));
          setProgressStage(Math.min(PROGRESS_STEPS.length - 1, Math.floor(p * PROGRESS_STEPS.length)));
          if (p < 1) requestAnimationFrame(raf); else setStep("result");
        };
        const id = requestAnimationFrame(raf);
        return () => cancelAnimationFrame(id);
      }, [step]);

      const [isSpeaking, setIsSpeaking] = useState(false);
      const [isPaused, setIsPaused] = useState(false);
      const [voices, setVoices] = useState([]);
      const utteranceRef = React.useRef(null);

      useEffect(() => {
        const loadVoices = () => setVoices(window.speechSynthesis.getVoices());
        loadVoices(); window.speechSynthesis.onvoiceschanged = loadVoices;
        return () => { window.speechSynthesis.onvoiceschanged = null; };
      }, []);

      const pickVoice = (code) => voices.find(v => (v.lang||"").toLowerCase().startsWith(code))
        || voices.find(v => /hi|te|gu|bn|ta|ml|mr|pa|kn/i.test(v.lang||""))
        || voices[0];

      const startTTS = () => {
        const text = outText;
        if (!text) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        const voice = pickVoice(lang.code); if (voice) u.voice = voice;
        u.rate = 0.95;
        u.onend = () => { setIsSpeaking(false); setIsPaused(false); };
        u.onerror = () => { setIsSpeaking(false); setIsPaused(false); };
        utteranceRef.current = u;
        window.speechSynthesis.speak(u);
        setIsSpeaking(true); setIsPaused(false);
      };
      const pauseTTS = () => { if (window.speechSynthesis.speaking && !window.speechSynthesis.paused) { window.speechSynthesis.pause(); setIsPaused(true); } };
      const resumeTTS = () => { if (window.speechSynthesis.paused) { window.speechSynthesis.resume(); setIsPaused(false); } };
      const stopTTS = () => { window.speechSynthesis.cancel(); setIsSpeaking(false); setIsPaused(false); };

      useEffect(() => { if (step === "result" && ttsAutoplay) { try { startTTS(); } catch {} } }, [step, ttsAutoplay]);

      useEffect(() => {
        const onKey = (e) => { if (e.shiftKey && e.key.toLowerCase() === 'w') { e.preventDefault(); setWozOpen(v => !v); } };
        window.addEventListener('keydown', onKey);
        return () => window.removeEventListener('keydown', onKey);
      }, []);

      const copySimplified = async () => {
        try { await navigator.clipboard.writeText(outText); alert("Copied simplified text to clipboard."); }
        catch (e) { alert("Copy failed. " + (e?.message || e)); }
      };
      const downloadFile = (name, content) => {
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob); const a = document.createElement("a");
        a.href = url; a.download = name; a.click(); URL.revokeObjectURL(url);
      };

      const LanguageScreen = () => {
        const [selectedLangCode, setSelectedLangCode] = useState(lang.code);

        const handleSelectLanguage = (l) => {
          setSelectedLangCode(l.code);
          setLang(l);
          // short delay before moving next so highlight appears cleanly
          setTimeout(() => setStep("gate"), 80);
        };

        return (
          <div className="mx-auto w-full max-w-3xl">
            <h1 className="mb-6 text-center text-2xl font-bold">{t('chooseLanguage')}</h1>
            <div className="grid grid-cols-1 gap-3 sm:grid-cols-3">
              {LANGS.map((l) => (
                <button
                  key={l.code}
                  onClick={() => handleSelectLanguage(l)}
                  className={cx(
                    "rounded-2xl border p-6 text-center text-lg shadow-sm transition",
                    selectedLangCode === l.code
                      ? "border-violet-600 ring-2 ring-violet-200"
                      : "border-zinc-200 hover:border-violet-300"
                  )}
                >
                  {l.label}
                </button>
              ))}
            </div>
            <p className="mt-6 text-center text-sm text-zinc-500">{t('guestHint')}</p>
          </div>
        );
      };

      const GateScreen = () => (
        <div className="mx-auto w-full max-w-2xl">
          <h1 className="mb-6 text-center text-2xl font-bold">{t('welcome')}</h1>
          <div className="grid grid-cols-1 gap-3">
            <button className="rounded-xl bg-violet-600 px-5 py-3 text-white" onClick={() =>
               { setAuthMode("guest"); setStep("questionnaire"); }}>{t('continueGuest')}</button>
            <button className="rounded-xl border border-zinc-300 px-5 py-3" onClick={() =>
               { setAuthMode("login"); setStep("questionnaire"); }}>{t('login')}</button>
            <button className="rounded-xl border border-zinc-300 px-5 py-3" onClick={() =>
               { setAuthMode("signup"); setStep("questionnaire"); }}>{t('createAccount')}</button>
          </div>
          <p className="mt-4 text-center text-xs text-zinc-500">{t('guestHint')}</p>
        </div>
      );

      const QuestionnaireScreen = () => (
        <div className="mx-auto w-full max-w-4xl space-y-6">
          <Section title={t('whatsHarder')}>
            <div className="grid grid-cols-1 gap-3 sm:grid-cols-2">
              <button className={cx("flex items-center justify-center gap-3 rounded-2xl border p-5 text-left shadow-sm", harder === "reading" ? "border-violet-600 ring-2 ring-violet-200" : "border-zinc-200 hover:border-violet-300")} onClick={() => setHarder("reading")}>
                <span className="text-2xl">ðŸ–¤</span>
                <div><div className="font-semibold">{t('readingText')}</div><div className="text-sm text-zinc-500">{t('readingHint')}</div></div>
              </button>
              <button className={cx("flex items-center justify-center gap-3 rounded-2xl border p-5 text-left shadow-sm", harder === "understanding" ? "border-violet-600 ring-2 ring-violet-200" : "border-zinc-200 hover:border-violet-300")} onClick={() => setHarder("understanding")}>
                <span className="text-2xl">ðŸ’¡</span>
                <div><div className="font-semibold">{t('understanding')}</div><div className="text-sm text-zinc-500">{t('understandingHint')}</div></div>
              </button>
            </div>
          </Section>

          <Section title={t('getsInTheWay')}>
            <div className="flex flex-wrap gap-2">
              {[
                { id: "small", label: "Small text" },
                { id: "tight", label: "Tight line spacing" },
                { id: "dense", label: "Dense paragraphs" },
                { id: "complex", label: "Complex words" },
                { id: "long", label: "Long sentences" },
                { id: "busy", label: "Busy layout" },
              ].map(o => (
                <Chip key={o.id} selected={obstacles.includes(o.id)} onClick={() => setObstacles(prev => prev.includes(o.id) ? prev.filter(x => x !== o.id) : [...prev, o.id])}>{t('obstacles.'+o.id)}</Chip>
              ))}
            </div>
          </Section>

          <Section title={t('previewSettings')}>
            <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
              <div><label className="text-sm">Text size: {prefFontPx}px</label><Range min={14} max={28} value={prefFontPx} onChange={setPrefFontPx} ariaLabel="Text size" /></div>
              <div><label className="text-sm">Line spacing: {prefLine.toFixed(1)}</label><Range min={1.2} max={2.2} step={0.1} value={prefLine} onChange={setPrefLine} ariaLabel="Line spacing" /></div>
              <div><label className="text-sm">Letter spacing: {(prefLetter * 100).toFixed(0)}%</label><Range min={0} max={0.1} step={0.005} value={prefLetter} onChange={setPrefLetter} ariaLabel="Letter spacing" /></div>
            </div>
            <div className="mt-3">
              <label className="flex items-center gap-2 text-sm"><input type="checkbox" className="accent-violet-600" checked={ttsAutoplay} onChange={(e)=>setTtsAutoplay(e.target.checked)} /> {t('readAloudQuestion')}</label>
            </div>
          </Section>

          <div className="flex items-center justify-between">
            <button className="rounded-xl border border-zinc-300 px-4 py-2" onClick={() => setStep("gate")}>{t('back')}</button>
            <div className="flex gap-2">
              <button className="rounded-xl border border-zinc-300 px-5 py-2" onClick={() => setStep("input")}>{t('skip')}</button>
              <button className="rounded-xl bg-violet-600 px-5 py-2 text-white disabled:opacity-50" disabled={!harder} onClick={() => setStep("input")}>{t('next')}</button>
            </div>
          </div>
        </div>
      );

      const InputScreen = () => (
        <div className="mx-auto w-full max-w-5xl space-y-5">
          <Section title={t('addYourText')}>
            <div className="mb-3 flex gap-2">
              <Chip selected={inputTab === "paste"} onClick={() => setInputTab("paste")}>{t('pasteText')}</Chip>
              <Chip selected={inputTab === "upload"} onClick={() => setInputTab("upload")}>{t('uploadFile')}</Chip>
            </div>
            {inputTab === "paste"
              ? <textarea className="h-56 w-full rounded-xl border border-zinc-300 p-3 focus:border-violet-400 focus:outline-none" placeholder={t('pastePlaceholder')} value={original} onChange={e => setOriginal(e.target.value)} />
              : (<div className="rounded-xl border border-dashed border-zinc-300 p-6 text-center">
                  <input type="file" accept=".txt" onChange={async (e) => {
                    const file = e.target.files?.[0]; if (!file) return;
                    try { const txt = await readTextFile(file); setUploadedFileName(file.name); setOriginal(txt); }
                    catch (err) { alert(err.message ?? String(err)); }
                  }} />
                  <p className="mt-2 text-xs text-zinc-500">{t('uploadHint')}</p>
                  {uploadedFileName && (<p className="mt-2 text-sm">{t('loaded')} <span className="font-medium">{uploadedFileName}</span></p>)}
                </div>)
            }
            <div className="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label className="text-sm">{t('summaryLength', { value: summaryLen })}</label>
                <Range min={25} max={300} value={summaryLen} onChange={setSummaryLen} ariaLabel="Summary length" />
                <div className="mt-1 flex gap-2">
                  {[50,100,150].map(n => <Chip key={n} selected={summaryLen===n} onClick={() => setSummaryLen(n)}>{n} words</Chip>)}
                  <Chip selected={summaryLen===120} onClick={() => setSummaryLen(120)}>Auto</Chip>
                </div>
              </div>
              <div className="grid grid-cols-2 gap-3">
                <label className="flex items-center gap-2 text-sm"><input type="checkbox" className="accent-violet-600" checked={optSimplifyVocab} onChange={e => setOptSimplifyVocab(e.target.checked)} /> {t('simplifyVocab')}</label>
                <label className="flex items-center gap-2 text-sm"><input type="checkbox" className="accent-violet-600" checked={optSplitLong} onChange={e => setOptSplitLong(e.target.checked)} /> {t('splitLongSentences')}</label>
              </div>
            </div>
            <div className="mt-5 flex items-center justify-between">
              <button className="rounded-xl border border-zinc-300 px-4 py-2" onClick={() => setStep("questionnaire")}>{t('back')}</button>
              <button className="rounded-xl bg-violet-600 px-5 py-2 text-white disabled:opacity-50" disabled={!original.trim()} onClick={() => setStep("processing")}>{t('simplifyAction')}</button>
            </div>
          </Section>
        </div>
      );

      const ProcessingScreen = () => (
        <div className="mx-auto w-full max-w-2xl">
          <Section title={t('workingOnIt')}>
            <div className="space-y-4">
              <div className="overflow-hidden rounded-full bg-violet-100">
                <div className="h-3 rounded-full bg-violet-600 transition-all" style={{ width: progress + "%" }} />
              </div>
              <ol className="grid grid-cols-1 gap-2 sm:grid-cols-5">
                {PROGRESS_STEPS.map((s, i) => <li key={s} className={cx("rounded-lg border px-3 py-2 text-center text-xs", i<=progressStage ? "border-violet-500 bg-violet-50 text-violet-700" : "border-zinc-200 text-zinc-500")}>{t(s)}</li>)}
              </ol>
              <p className="text-center text-sm text-zinc-500">{t('detectedLanguage')} <span className="font-medium">{lang.uiLabel}</span></p>
            </div>
          </Section>
        </div>
      );

      const ResultsScreen = () => (
        <div className="mx-auto w-full max-w-6xl space-y-5">
          <div className="flex flex-wrap items-center justify-between gap-3">
            <h1 className="text-2xl font-bold">{t('yourSimplifiedText')}</h1>
            <div className="flex items-center gap-2">
              <Chip selected={theme==="light"} onClick={() => setTheme("light")}>{t('themeLight')}</Chip>
              <Chip selected={theme==="sepia"} onClick={() => setTheme("sepia")}>{t('themeSepia')}</Chip>
              <Chip selected={theme==="dark"} onClick={() => setTheme("dark")}>{t('themeDark')}</Chip>
            </div>
          </div>

          <div className="grid grid-cols-1 gap-4 lg:grid-cols-2">
            {showOriginal && (
              <Section title={t('original')}>
                <div className="max-h-[60vh] overflow-auto rounded-xl border border-zinc-200 bg-white p-4 text-[16px] leading-7">{original || <span className="text-zinc-400">{t('empty')}</span>}</div>
              </Section>
            )}

            <Section title={t('simplified')}>
              <div className={cx("max-h-[60vh] overflow-auto rounded-xl border p-4", THEME_CLASSES[theme])}>
                <div style={{ fontSize: fontPx, lineHeight: lineHeight, letterSpacing: (Math.round(letterSpacingEm*1000)/1000)+"em", fontWeight: weightBold ? 600 : 400 }}>
                  {(() => {
                    // If the output looks like HTML (contains <strong>/<b> etc.), render sanitized HTML so bolding is preserved.
                    const looksLikeHtml = isHtmlString(outText);
                    if (assistOn) {
                      // For assistive rendering: if the output contains HTML, show the sanitized HTML instead
                      // (renderAssistiveNodes expects plain text and would mangle tags).
                      if (looksLikeHtml) {
                        return outText ? <div dangerouslySetInnerHTML={{ __html: sanitizeHtml(outText) }} /> : <span className="opacity-50">{t('noOutput')}</span>;
                      }
                      return renderAssistiveNodes(outText, lang.code, { boldFirstN, enableCharAssist: charAssist });
                    } else {
                      if (looksLikeHtml) return <div dangerouslySetInnerHTML={{ __html: sanitizeHtml(outText) }} />;
                      return outText || <span className="opacity-50">{t('noOutput')}</span>;
                    }
                  })()}
                </div>
              </div>

              <div className="mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2">
                <div><label className="text-sm">Font size: {fontPx}px</label><Range min={14} max={30} value={fontPx} onChange={setFontPx} ariaLabel="Font size" /></div>
                <div><label className="text-sm">Line spacing: {lineHeight.toFixed(1)}</label><Range min={1.2} max={2.2} step={0.1} value={lineHeight} onChange={setLineHeight} ariaLabel="Line spacing" /></div>
                <div><label className="text-sm">Letter spacing: {(letterSpacingEm*100).toFixed(0)}%</label><Range min={0} max={0.1} step={0.005} value={letterSpacingEm} onChange={setLetterSpacingEm} ariaLabel="Letter spacing" /></div>
                <div className="flex flex-col gap-2">
                  <label className="flex items-center gap-2 text-sm"><input type="checkbox" className="accent-violet-600" checked={weightBold} onChange={e => setWeightBold(e.target.checked)} /> Bold text</label>
                  <label className="flex items-center gap-2 text-sm"><input type="checkbox" className="accent-violet-600" checked={showOriginal} onChange={e => setShowOriginal(e.target.checked)} /> Show original</label>
                </div>
              </div>

              <Section className="mt-4" title={t('readingAssists')}>
                <div className="grid grid-cols-1 gap-3 sm:grid-cols-3">
                  <label className="flex items-center gap-2 text-sm"><input type="checkbox" className="accent-violet-600" checked={assistOn} onChange={e => setAssistOn(e.target.checked)} /> {t('enableAssists')}</label>
                  <div><label className="text-sm">{t('firstVarna', { value: boldFirstN })}</label><Range min={1} max={3} value={boldFirstN} onChange={setBoldFirstN} ariaLabel="Bold first N graphemes" /></div>
                  {lang.code==="hi" && (<label className="flex items-center gap-2 text-sm"><input type="checkbox" className="accent-violet-600" checked={charAssist} onChange={e => setCharAssist(e.target.checked)} /> {t('hindiCharAssists')}</label>)}
                </div>
                <p className="mt-2 text-xs text-zinc-500">{t('assistsDescription')}</p>
              </Section>

              <div className="mt-6 flex flex-wrap items-center gap-3">
                <button onClick={() => (isSpeaking ? stopTTS() : startTTS())} className="flex items-center gap-2 rounded-xl bg-black px-4 py-2 text-white" aria-label="Read aloud" title={t('readAloud')}>
                  <span className="inline-flex h-5 w-5 items-center justify-center rounded-full bg-white text-black">{isSpeaking ? "â– " : "â–¶"}</span>
                  <span>{lang.ttsLabel}</span>
                </button>
                <button onClick={isPaused ? resumeTTS : pauseTTS} disabled={!isSpeaking} className="rounded-xl border border-zinc-300 px-3 py-2 disabled:opacity-50">{isPaused ? t('resume') : t('pause')}</button>
                <button onClick={stopTTS} disabled={!isSpeaking} className="rounded-xl border border-zinc-300 px-3 py-2 disabled:opacity-50">{t('stop')}</button>
              </div>

              <div className="mt-6 flex flex-wrap items-center gap-2">
                <button className="rounded-xl border border-zinc-300 px-4 py-2" onClick={copySimplified}>{t('copy')}</button>
                <button className="rounded-xl border border-zinc-300 px-4 py-2" onClick={() => downloadFile("simplified.txt", outText)}>{t('downloadTxt')}</button>
                <button className="rounded-xl border border-zinc-300 px-4 py-2" onClick={() => setStep("input")}>{t('startOver')}</button>
              </div>
            </Section>
          </div>
        </div>
      );

      return (
        <div className="min-h-screen">
          <div className="mx-auto mb-6 max-w-6xl rounded-2xl border border-violet-200 bg-white/70 p-4 text-center shadow-sm backdrop-blur">
            <div className="text-sm uppercase tracking-wider text-violet-700">Prototype</div>
            <div className="text-2xl font-extrabold">Text Simplifier</div>
            <div className="text-xs text-zinc-500">Language-aware, questionnaire-guided summarization â€¢ TTS â€¢ Reading assists â€¢ WoZ</div>
          </div>

          {wozOpen && (
            <div className="fixed bottom-4 right-4 z-50 w-[min(420px,calc(100vw-2rem))] rounded-2xl border border-violet-300 bg-white p-4 shadow-xl">
              <div className="flex items-center justify-between">
                <div className="text-sm font-semibold text-violet-700">{t('wizardPanel')}</div>
                <button className="text-xs text-zinc-500" onClick={() => setWozOpen(false)}>{t('close')}</button>
              </div>
              <div className="mt-2 grid grid-cols-2 gap-2">
                <button className="rounded-md border px-2 py-1 text-sm" onClick={() => { setHarder("reading"); setFontPx(20); setLineHeight(1.9); setLetterSpacingEm(0.03); setWeightBold(true); }}>{t('presetReading')}</button>
                <button className="rounded-md border px-2 py-1 text-sm" onClick={() => { setHarder("understanding"); setOptSplitLong(true); setOptSimplifyVocab(true); }}>{t('presetUnderstanding')}</button>
                <button className="rounded-md border px-2 py-1 text-sm" onClick={() => setShowOriginal(v => !v)}>{t('toggleOriginal')}</button>
                <button className="rounded-md border px-2 py-1 text-sm" onClick={() => setTheme("sepia")}>{t('themeSepiaButton')}</button>
              </div>
              <textarea value={wozDraft} onChange={(e) => setWozDraft(e.target.value)} className="mt-3 h-24 w-full rounded-md border p-2 text-sm" placeholder={t('wozPlaceholder')}></textarea>
              <div className="mt-2 flex gap-2">
                <button className="rounded-md border px-3 py-1 text-sm" onClick={() => setForcedSimplified(wozDraft || null)}>{t('replaceSimplified')}</button>
                <button className="rounded-md border px-3 py-1 text-sm" onClick={() => setForcedSimplified(null)}>{t('useComputed')}</button>
              </div>
            </div>
          )}

          {step === "language" && <LanguageScreen />}
          {step === "gate" && <GateScreen />}
          {step === "questionnaire" && <QuestionnaireScreen />}
          {step === "input" && <InputScreen />}
          {step === "processing" && <ProcessingScreen />}
          {step === "result" && <ResultsScreen />}

          <footer className="mx-auto mt-10 max-w-6xl text-center text-xs text-zinc-500">
            <div className="mb-2">{t('currentLanguage')} <span className="font-medium">{lang.uiLabel}</span></div>
            <div className="flex flex-wrap items-center justify-center gap-2">
              {LANGS.map((l) => (
                <Chip
                  key={l.code}
                  selected={l.code === lang.code}
                  onClick={() => {
                    setLang(l);
                    window.__app_lang_code__ = l.code;
                  }}
                >
                  {l.label}
                </Chip>
              ))}
            </div>
            <div className="mt-2 text-[11px] text-zinc-400">
              {t('wizardHint', { value: ttsAutoplay ? 'Auto-read: on' : 'Auto-read: off' })}
            </div>
          </footer>

        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
